<!DOCTYPE html>

<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=0.5,minimum-scale=0.5,maximum-scale=2.0,user-scalable=yes">
		<title></title>
		<style>
			*
			{
				margin : 0;
				padding : 0;
			}

			.board
			{
				width : 100%;
				height : 100%;
			}
		</style>
	</head>
	<body>
		<script src="js/ShaderNode.js"></script>
		<script src="js/GifNode.js"></script>
		<script>

			var sub = window.open( 'about:blank', 'sub', 'menubar=no' );

			var begint = +new Date();
			var time = 0;
			var bpm = 120;

			var nodes = [];

			var input = document.createElement( 'input' );
			input.type = 'file';
			input.multiple = true;
			input.onchange = function( _e ){

				for( var i=0, file; file=_e.target.files[i]; i++ ){

					var ext = '';
					if( /\.([^.]+)$/.test( file.name ) ){
						ext = /\.([^.]+)$/.exec( file.name )[1];
					}else{
						console.error( file.name+' has no extension' );
					}

					if( ext == 'glsl' ){

						var node = new ShaderNode( file );
						nodes.push( node );
						document.body.appendChild( node.canvas );
						(function( _file ){
							node.canvas.onclick = function(){
								selectedShader = _file.name;
							};
						}( file ));

					}else if( ext == 'gif' ){

						var node = new GifNode( file );
						nodes.push( node );
						document.body.appendChild( node.canvas );
						(function( _file ){
							node.canvas.onclick = function(){
								selectedGif = _file.name;
							};
						}( file ));

					}else{
						console.error( file.name+' is unsupported extension' );
					}
				}

			};

			sub.document.body.appendChild( input );

			function loop(){

				time = ( +new Date() - begint )*1e-3;

				for( var node of nodes ){
					node.draw();
				}

				requestAnimationFrame( loop );
			}
			requestAnimationFrame( loop );

		</script>
	</body>
</html>
